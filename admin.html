<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SDT | Y√∂netim Merkezi</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Serif+4:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root { --ink: #0e0e14; --gold: #c9a84c; --crimson: #8b1a2b; --parchment: #f5f0e8; --panel-bg: #121218; }
  * { box-sizing: border-box; font-family: 'Source Serif 4', serif; }
  body { background: var(--ink); color: var(--parchment); margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
  
  /* Gƒ∞Rƒ∞≈û EKRANI */
  #login-screen { position: fixed; inset: 0; background: var(--ink); display: flex; align-items: center; justify-content: center; z-index: 999; }
  .login-box { background: rgba(255,255,255,0.03); padding: 40px; border: 1px solid var(--gold); border-top: 4px solid var(--gold); width: 100%; max-width: 360px; text-align: center; }
  
  /* PANEL GENEL */
  #admin-panel { display: none; grid-template-columns: 240px 1fr; min-height: 100vh; }
  
  /* SOL MEN√ú */
  .sidebar { background: #08080a; border-right: 1px solid #222; padding: 20px; display: flex; flex-direction: column; }
  .brand { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 20px; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
  .nav-btn { 
    background: transparent; border: none; color: #888; text-align: left; padding: 12px 15px; 
    margin-bottom: 5px; cursor: pointer; transition: all 0.2s; border-radius: 4px; font-size: 14px;
  }
  .nav-btn:hover { background: rgba(255,255,255,0.05); color: var(--parchment); }
  .nav-btn.active { background: rgba(201,168,76,0.15); color: var(--gold); border-left: 3px solid var(--gold); }
  .logout-btn { margin-top: auto; background: #1a1a20; color: #aaa; border: 1px solid #333; }

  /* SAƒû ƒ∞√áERƒ∞K */
  .main-content { padding: 40px; overflow-y: auto; background: var(--panel-bg); }
  .section-title { font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 15px; }
  .content-section { display: none; animation: fadeIn 0.3s; }
  .content-section.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  /* KARTLAR VE FORMLAR */
  .card { background: rgba(255,255,255,0.02); border: 1px solid #2a2a35; padding: 25px; margin-bottom: 20px; border-radius: 4px; }
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
  .stat-card { background: #1a1a24; padding: 20px; text-align: center; border: 1px solid #333; border-radius: 4px; }
  .stat-num { font-size: 32px; font-weight: bold; color: var(--gold); display: block; }
  .stat-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 8px; }
  input, textarea, select { 
    width: 100%; background: #1a1a20; border: 1px solid #333; color: var(--parchment); padding: 12px; 
    font-size: 14px; border-radius: 4px; outline: none; transition: border 0.2s;
  }
  input:focus, textarea:focus { border-color: var(--gold); }
  
  .btn-primary { background: var(--gold); color: var(--ink); border: none; padding: 12px 24px; font-weight: bold; cursor: pointer; border-radius: 2px; }
  .btn-primary:hover { background: #e2c97e; }
  .btn-danger { background: var(--crimson); color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 12px; border-radius: 2px; }

  /* TABLO */
  table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
  th { text-align: left; color: #666; font-weight: normal; border-bottom: 1px solid #333; padding: 10px; font-size: 12px; }
  td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; }
  tr:hover { background: rgba(255,255,255,0.02); }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    #admin-panel { grid-template-columns: 1fr; }
    .sidebar { display: none; } 
  }
</style>
</head>
<body>

<div id="login-screen">
  <div class="login-box">
    <div style="font-size:40px; color:var(--gold); margin-bottom:10px;">Œ£</div>
    <h2 style="margin:0 0 20px 0;">Y√ñNETƒ∞M PANELƒ∞</h2>
    <input type="email" id="email" placeholder="E-Posta" style="margin-bottom:10px;">
    <input type="password" id="password" placeholder="≈ûifre" style="margin-bottom:20px;">
    <button onclick="login()" class="btn-primary" style="width:100%">Gƒ∞Rƒ∞≈û YAP</button>
    <p id="login-msg" style="color:var(--crimson); font-size:12px; margin-top:15px;"></p>
  </div>
</div>

<div id="admin-panel">
  <aside class="sidebar">
    <div class="brand"><span>Œ£</span> SDT Admin</div>
    <button class="nav-btn active" onclick="showSection('dashboard')">üìä Genel Bakƒ±≈ü</button>
    <button class="nav-btn" onclick="showSection('basvurular')">üìù √úye Ba≈üvurularƒ±</button>
    <button class="nav-btn" onclick="showSection('ayarlar')">‚öôÔ∏è Site Ayarlarƒ±</button>
    <button class="logout-btn nav-btn" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
  </aside>

  <main class="main-content">
    
    <section id="sec-dashboard" class="content-section active">
      <h2 class="section-title">Genel Bakƒ±≈ü</h2>
      <div class="card">
        <h3>Saya√ß Y√∂netimi</h3>
        <p style="color:#666; font-size:13px; margin-bottom:20px;">Ana sayfadaki istatistikleri buradan g√ºncelleyebilirsiniz.</p>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-num" id="live-count1">0</span>
            <input type="number" id="inp-count1" placeholder="√úye Sayƒ±sƒ±" style="margin-top:10px; text-align:center;">
          </div>
          <div class="stat-card">
            <span class="stat-num" id="live-count2">0</span>
            <input type="number" id="inp-count2" placeholder="Etkinlik Sayƒ±sƒ±" style="margin-top:10px; text-align:center;">
          </div>
          <div class="stat-card">
            <span class="stat-num" id="live-count3">0</span>
            <input type="number" id="inp-count3" placeholder="Yƒ±llƒ±k Deneyim" style="margin-top:10px; text-align:center;">
          </div>
          <div class="stat-card">
            <span class="stat-num" id="live-count4">0</span>
            <input type="number" id="inp-count4" placeholder="Panel Sayƒ±sƒ±" style="margin-top:10px; text-align:center;">
          </div>
        </div>
        <button class="btn-primary" onclick="updateStats()">SAYA√áLARI G√úNCELLE</button>
      </div>
    </section>

    <section id="sec-basvurular" class="content-section">
      <h2 class="section-title">Gelen Ba≈üvurular</h2>
      <div class="card">
        <table id="basvuru-table">
          <thead>
            <tr>
              <th>Tarih</th>
              <th>Ad Soyad</th>
              <th>B√∂l√ºm / Sƒ±nƒ±f</th>
              <th>E-Posta</th>
              <th>ƒ∞≈ülem</th>
            </tr>
          </thead>
          <tbody id="basvuru-list">
            <tr><td colspan="5" style="text-align:center;">Y√ºkleniyor...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="sec-ayarlar" class="content-section">
      <h2 class="section-title">Site Ayarlarƒ±</h2>
      <div class="card">
        <div class="form-group">
          <label>Hakkƒ±mƒ±zda Yazƒ±sƒ± (Ana Sayfa)</label>
          <textarea id="set-hakkimizda" rows="6" placeholder="Siyasal D√º≈ü√ºnceler Topluluƒüu..."></textarea>
        </div>
        <button class="btn-primary" onclick="saveSettings()">AYARLARI KAYDET</button>
      </div>
    </section>

  </main>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // ‚úÖ KODLARINI SENƒ∞N YERƒ∞NE YERLE≈ûTƒ∞RDƒ∞M ‚úÖ
  const firebaseConfig = {
    apiKey: "AIzaSyDPLsa0Vstirz25FU4JAp5oUcTHJXcOM5I",
    authDomain: "siyasal-dusunceler-toplulugu.firebaseapp.com",
    projectId: "siyasal-dusunceler-toplulugu",
    storageBucket: "siyasal-dusunceler-toplulugu.firebasestorage.app",
    messagingSenderId: "739243257292",
    appId: "1:739243257292:web:2297646bb9296077088169",
    measurementId: "G-TE8JH9KR9G"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- Gƒ∞Rƒ∞≈û / √áIKI≈û ---
  window.login = () => {
    const e = document.getElementById('email').value;
    const p = document.getElementById('password').value;
    signInWithEmailAndPassword(auth, e, p).catch(err => alert("Hata: " + err.message));
  }
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'grid';
      initApp();
    } else {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('admin-panel').style.display = 'none';
    }
  });

  function initApp() {
    subscribeBasvurular();
    loadSettings();
  }

  // --- 1. BA≈ûVURULARI √áEK ---
  function subscribeBasvurular() {
    const q = query(collection(db, "basvurular"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snap) => {
      const list = document.getElementById('basvuru-list');
      list.innerHTML = "";
      if(snap.empty) { list.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>Hen√ºz ba≈üvuru yok.</td></tr>"; return; }
      
      snap.forEach(d => {
        const data = d.data();
        let dateStr = "-";
        if(data.timestamp) {
            const dateObj = data.timestamp.toDate();
            dateStr = dateObj.toLocaleDateString('tr-TR') + " " + dateObj.toLocaleTimeString('tr-TR').slice(0,5);
        }

        list.innerHTML += `
          <tr>
            <td style="font-size:12px; color:#888;">${dateStr}</td>
            <td style="color:#fff; font-weight:bold;">${data.ad} ${data.soyad}</td>
            <td>${data.bolum}<br><small style="color:#666">${data.sinif}</small></td>
            <td>${data.email}</td>
            <td><button class="btn-danger" onclick="deleteItem('basvurular', '${d.id}')">Sil</button></td>
          </tr>
        `;
      });
    });
  }

  // --- 2. SAYA√áLARI G√úNCELLEME ---
  window.updateStats = async () => {
    const stats = {
        count1: document.getElementById('inp-count1').value,
        count2: document.getElementById('inp-count2').value,
        count3: document.getElementById('inp-count3').value,
        count4: document.getElementById('inp-count4').value
    };
    try {
        await setDoc(doc(db, "ayarlar", "sayaclar"), stats);
        alert("‚úÖ Saya√ßlar g√ºncellendi!");
    } catch(e) { alert("Hata: " + e.message); }
  }

  // --- 3. GENEL AYARLARI KAYDET ---
  window.saveSettings = async () => {
    const text = document.getElementById('set-hakkimizda').value;
    try {
      await setDoc(doc(db, "ayarlar", "genel"), { hakkimizda: text }, { merge: true });
      alert("‚úÖ Hakkƒ±mƒ±zda yazƒ±sƒ± g√ºncellendi!");
    } catch(e) { alert("Hata: " + e.message); }
  }

  async function loadSettings() {
    const genSnap = await getDoc(doc(db, "ayarlar", "genel"));
    if(genSnap.exists()) {
        document.getElementById('set-hakkimizda').value = genSnap.data().hakkimizda || "";
    }
    const statSnap = await getDoc(doc(db, "ayarlar", "sayaclar"));
    if(statSnap.exists()) {
        const d = statSnap.data();
        document.getElementById('inp-count1').value = d.count1 || 0;
        document.getElementById('inp-count2').value = d.count2 || 0;
        document.getElementById('inp-count3').value = d.count3 || 0;
        document.getElementById('inp-count4').value = d.count4 || 0;
        
        document.getElementById('live-count1').innerText = d.count1 || 0;
        document.getElementById('live-count2').innerText = d.count2 || 0;
        document.getElementById('live-count3').innerText = d.count3 || 0;
        document.getElementById('live-count4').innerText = d.count4 || 0;
    }
  }
