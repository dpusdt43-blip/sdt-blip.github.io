<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SDT | Genel YÃ¶netim Merkezi</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Serif+4:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root { --ink: #0e0e14; --gold: #c9a84c; --crimson: #8b1a2b; --parchment: #f5f0e8; --panel-bg: #121218; }
  * { box-sizing: border-box; font-family: 'Source Serif 4', serif; }
  body { background: var(--ink); color: var(--parchment); margin: 0; min-height: 100vh; }
  
  /* GÄ°RÄ°Å EKRANI STÄ°LLERÄ° */
  #login-screen { position: fixed; inset: 0; background: var(--ink); display: flex; align-items: center; justify-content: center; z-index: 999; }
  .login-box { background: rgba(255,255,255,0.03); padding: 40px; border: 1px solid var(--gold); border-top: 4px solid var(--gold); width: 100%; max-width: 360px; text-align: center; }
  
  /* PANEL GENEL */
  #admin-panel { display: none; display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }
  
  /* SOL MENÃœ */
  .sidebar { background: #08080a; border-right: 1px solid #222; padding: 20px; display: flex; flex-direction: column; }
  .brand { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 20px; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
  .brand span { font-size: 32px; }
  .nav-btn { 
    background: transparent; border: none; color: #888; text-align: left; padding: 12px 15px; 
    margin-bottom: 5px; cursor: pointer; transition: all 0.2s; border-radius: 4px; font-size: 14px;
  }
  .nav-btn:hover { background: rgba(255,255,255,0.05); color: var(--parchment); }
  .nav-btn.active { background: rgba(201,168,76,0.15); color: var(--gold); border-left: 3px solid var(--gold); }
  
  .logout-btn { margin-top: auto; background: #1a1a20; color: #aaa; border: 1px solid #333; }

  /* SAÄ Ä°Ã‡ERÄ°K */
  .main-content { padding: 40px; overflow-y: auto; background: var(--panel-bg); }
  .section-title { font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 15px; }
  
  .content-section { display: none; animation: fadeIn 0.3s; }
  .content-section.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  /* FORMLAR & KARTLAR */
  .card { background: rgba(255,255,255,0.02); border: 1px solid #2a2a35; padding: 25px; margin-bottom: 20px; border-radius: 4px; }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-bottom: 8px; }
  input, textarea, select { 
    width: 100%; background: #1a1a20; border: 1px solid #333; color: var(--parchment); padding: 12px; 
    font-size: 14px; border-radius: 4px; outline: none; transition: border 0.2s;
  }
  input:focus, textarea:focus { border-color: var(--gold); }
  
  .btn-primary { background: var(--gold); color: var(--ink); border: none; padding: 12px 24px; font-weight: bold; cursor: pointer; border-radius: 2px; }
  .btn-primary:hover { background: #e2c97e; }
  
  /* TABLO (BAÅVURULAR Ä°Ã‡Ä°N) */
  .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
  .data-table th { text-align: left; color: #666; font-weight: normal; border-bottom: 1px solid #333; padding: 10px; font-size: 12px; }
  .data-table td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; }
  .data-table tr:hover { background: rgba(255,255,255,0.02); }
  
  .badge { padding: 3px 8px; border-radius: 3px; font-size: 10px; text-transform: uppercase; }
  .badge-new { background: rgba(201,168,76,0.2); color: var(--gold); }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    #admin-panel { grid-template-columns: 1fr; }
    .sidebar { display: none; } /* Mobilde menÃ¼ gizli (geliÅŸtirilebilir) */
  }
</style>
</head>
<body>

<div id="login-screen">
  <div class="login-box">
    <div style="font-size:40px; color:var(--gold); margin-bottom:10px;">Î£</div>
    <h2 style="margin:0 0 20px 0; font-family:'Playfair Display',serif;">YÃ¶netim Paneli</h2>
    <input type="email" id="email" placeholder="E-Posta" style="margin-bottom:10px;">
    <input type="password" id="password" placeholder="Åifre" style="margin-bottom:20px;">
    <button onclick="login()" class="btn-primary" style="width:100%">GÄ°RÄ°Å YAP</button>
    <p id="login-msg" style="color:var(--crimson); font-size:12px; margin-top:15px;"></p>
  </div>
</div>

<div id="admin-panel" style="display:none;">
  <aside class="sidebar">
    <div class="brand"><span>Î£</span> SDT Admin</div>
    <button class="nav-btn active" onclick="showSection('dashboard')">ğŸ“Š Gelen BaÅŸvurular</button>
    <button class="nav-btn" onclick="showSection('settings')">âš™ï¸ Genel Ayarlar</button>
    <button class="nav-btn" onclick="showSection('duyurular')">ğŸ“¢ Duyurular</button>
    <button class="nav-btn" onclick="showSection('etkinlikler')">ğŸ“… Etkinlikler</button>
    <button class="logout-btn nav-btn" onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
  </aside>

  <main class="main-content">
    
    <section id="sec-dashboard" class="content-section active">
      <h2 class="section-title">Ãœye BaÅŸvurularÄ±</h2>
      <div class="card">
        <p style="color:#666; font-size:13px; margin-bottom:20px;">Web sitesindeki "Ãœye Ol" formunu dolduranlar buraya dÃ¼ÅŸer.</p>
        <div style="overflow-x:auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Ad Soyad</th>
                <th>BÃ¶lÃ¼m / SÄ±nÄ±f</th>
                <th>E-Posta</th>
                <th>Tarih</th>
                <th>Ä°ÅŸlem</th>
              </tr>
            </thead>
            <tbody id="basvuru-list">
              <tr><td colspan="5" style="text-align:center; padding:20px;">YÃ¼kleniyor...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="sec-settings" class="content-section">
      <h2 class="section-title">Site Genel AyarlarÄ±</h2>
      <div class="card">
        <h3 style="color:var(--gold); margin-top:0;">1. Ä°letiÅŸim Bilgileri</h3>
        <div class="form-group">
          <label>E-Posta Adresi (Footer'da gÃ¶rÃ¼nÃ¼r)</label>
          <input type="text" id="set-email" placeholder="ornek@dpu.edu.tr">
        </div>
        <div class="form-group">
          <label>Adres / Ofis Bilgisi</label>
          <input type="text" id="set-address" placeholder="Ä°Ä°BF, B Blok...">
        </div>
        <div class="form-group">
          <label>Instagram / Sosyal Medya Linki</label>
          <input type="text" id="set-social" placeholder="https://instagram.com/...">
        </div>
      </div>

      <div class="card">
        <h3 style="color:var(--gold); margin-top:0;">2. HakkÄ±mÄ±zda YazÄ±sÄ±</h3>
        <div class="form-group">
          <label>Ana Sayfa HakkÄ±mÄ±zda Metni</label>
          <textarea id="set-about" rows="6" placeholder="Siyasal DÃ¼ÅŸÃ¼nceler TopluluÄŸu..."></textarea>
        </div>
        <button class="btn-primary" onclick="saveSettings()">AYARLARI KAYDET</button>
      </div>
    </section>

    <section id="sec-duyurular" class="content-section">
      <h2 class="section-title">Duyuru YÃ¶netimi</h2>
      <div class="card">
        <div class="form-group"><input type="text" id="d-baslik" placeholder="BaÅŸlÄ±k"></div>
        <div class="form-group"><textarea id="d-icerik" placeholder="Ä°Ã§erik"></textarea></div>
        <div style="display:flex; gap:10px;">
          <input type="date" id="d-tarih">
          <select id="d-etiket"><option>Genel</option><option>Yeni</option><option>Acil</option></select>
          <button class="btn-primary" onclick="addDuyuru()">EKLE</button>
        </div>
      </div>
      <div id="duyuru-list" style="margin-top:20px;"></div>
    </section>

    <section id="sec-etkinlikler" class="content-section">
      <h2 class="section-title">Etkinlik YÃ¶netimi</h2>
      <div class="card">
        <div class="form-group"><input type="text" id="e-baslik" placeholder="Etkinlik AdÄ±"></div>
        <div class="form-group"><textarea id="e-aciklama" placeholder="AÃ§Ä±klama"></textarea></div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <input type="date" id="e-tarih" style="flex:1">
          <input type="text" id="e-saat" placeholder="Saat" style="flex:1">
          <input type="text" id="e-konum" placeholder="Konum" style="flex:1">
          <button class="btn-primary" onclick="addEtkinlik()">PLANLA</button>
        </div>
      </div>
      <div id="etkinlik-list" style="margin-top:20px;"></div>
    </section>

  </main>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // ğŸ”´ SENÄ°N AYARLARIN BURAYA ğŸ”´
  const firebaseConfig = {
    apiKey: "AIzaSyDPLsa0Vstirz25FU4JAp5oUcTHJXcOM5I",
    authDomain: "siyasal-dusunceler-toplulugu.firebaseapp.com",
    projectId: "siyasal-dusunceler-toplulugu",
    storageBucket: "siyasal-dusunceler-toplulugu.firebasestorage.app",
    messagingSenderId: "739243257292",
    appId: "1:739243257292:web:2297646bb9296077088169",
    measurementId: "G-TE8JH9KR9G"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- GÄ°RÄ°Å / Ã‡IKIÅ ---
  window.login = () => {
    const e = document.getElementById('email').value;
    const p = document.getElementById('password').value;
    signInWithEmailAndPassword(auth, e, p).catch(err => alert("Hata: " + err.message));
  }
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'grid'; // Grid yapÄ±sÄ±nÄ± bozmamak iÃ§in
      initApp();
    } else {
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('admin-panel').style.display = 'none';
    }
  });

  function initApp() {
    subscribeBasvurular();
    subscribeDuyurular();
    subscribeEtkinlikler();
    loadSettings();
  }

  // --- 1. BAÅVURULARI Ã‡EK ---
  function subscribeBasvurular() {
    const q = query(collection(db, "basvurular"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snap) => {
      const list = document.getElementById('basvuru-list');
      list.innerHTML = "";
      if(snap.empty) { list.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>HenÃ¼z baÅŸvuru yok.</td></tr>"; return; }
      
      snap.forEach(d => {
        const data = d.data();
        const date = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleDateString('tr-TR') : '-';
        list.innerHTML += `
          <tr>
            <td style="color:#fff; font-weight:bold;">${data.ad} ${data.soyad}</td>
            <td>${data.bolum} <br><small style="color:#666">${data.sinif}</small></td>
            <td>${data.email}</td>
            <td>${date}</td>
            <td><button style="background:#8b1a2b; border:none; color:#fff; padding:5px; cursor:pointer;" onclick="deleteItem('basvurular', '${d.id}')">Sil</button></td>
          </tr>
        `;
      });
    });
  }

  // --- 2. GENEL AYARLARI KAYDET / YÃœKLE ---
  window.saveSettings = async () => {
    const settings = {
      email: document.getElementById('set-email').value,
      address: document.getElementById('set-address').value,
      social: document.getElementById('set-social').value,
      aboutText: document.getElementById('set-about').value
    };
    try {
      // 'ayarlar' koleksiyonunda 'genel' adlÄ± tek bir dokÃ¼man tutacaÄŸÄ±z
      await setDoc(doc(db, "ayarlar", "genel"), settings);
      alert("âœ… Ayarlar baÅŸarÄ±yla gÃ¼ncellendi!");
    } catch(e) { alert("Hata: " + e.message); }
  }

  async function loadSettings() {
    const docSnap = await getDoc(doc(db, "ayarlar", "genel"));
    if (docSnap.exists()) {
      const data = docSnap.data();
      document.getElementById('set-email').value = data.email || "";
      document.getElementById('set-address').value = data.address || "";
      document.getElementById('set-social').value = data.social || "";
      document.getElementById('set-about').value = data.aboutText || "";
    }
  }

  // --- STANDART FONKSÄ°YONLAR ---
  window.addDuyuru = async () => {
     await addDoc(collection(db, "duyurular"), {
       baslik: document.getElementById('d-baslik').value,
       icerik: document.getElementById('d-icerik').value,
       tarih: document.getElementById('d-tarih').value,
       etiket: document.getElementById('d-etiket').value,
       timestamp: new Date()
     });
     alert("Duyuru Eklendi");
  }
  
  function subscribeDuyurular() {
    onSnapshot(query(collection(db, "duyurular"), orderBy("timestamp", "desc")), (snap) => {
       const div = document.getElementById('duyuru-list'); div.innerHTML = "";
       snap.forEach(d => div.innerHTML += `<div class="card" style="padding:10px;">${d.data().baslik} <button onclick="deleteItem('duyurular','${d.id}')" style="float:right; color:red; background:none; border:none;">Sil</button></div>`);
    });
  }

  window.addEtkinlik = async () => {
     await addDoc(collection(db, "etkinlikler"), {
       baslik: document.getElementById('e-baslik').value,
       aciklama: document.getElementById('e-aciklama').value,
       tarih: document.getElementById('e-tarih').value,
       saat: document.getElementById('e-saat').value,
       konum: document.getElementById('e-konum').value,
       timestamp: new Date()
     });
     alert("Etkinlik Eklendi");
  }

  function subscribeEtkinlikler() {
    onSnapshot(query(collection(db, "etkinlikler"), orderBy("timestamp", "desc")), (snap) => {
       const div = document.getElementById('etkinlik-list'); div.innerHTML = "";
       snap.forEach(d => div.innerHTML += `<div class="card" style="padding:10px;">${d.data().baslik} <button onclick="deleteItem('etkinlikler','${d.id}')" style="float:right; color:red; background:none; border:none;">Sil</button></div>`);
    });
  }

  window.deleteItem = async (col, id) => {
    if(confirm("Silmek istediÄŸine emin misin?")) await deleteDoc(doc(db, col, id));
  }

  // MenÃ¼ GeÃ§iÅŸleri
  window.showSection = (id) => {
    document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
    document.getElementById('sec-' + id).classList.add('active');
    event.target.classList.add('active');
  }
</script>
</body>
</html>
